# 지식 그래프 기능 활성화 가이드

이 문서는 WeKnora에서 지식 그래프(Neo4j) 기능을 활성화하고 검증하는 방법을 소개하며, 환경 준비부터 프론트엔드 구성까지의 전체 과정을 완료하도록 돕습니다.

## 전제 조건

- WeKnora 백엔드 및 프론트엔드의 기본 배포가 완료되어야 합니다.
- 사용 가능한 Docker/Docker Compose 실행 환경이 있어야 합니다.
- 로컬 또는 원격에서 액세스 가능한 Neo4j 서비스가 있어야 합니다(프로젝트에 포함된 Docker Compose 사용 권장).

## 1단계: 환경 변수 구성

프로젝트 루트 디렉터리의 `.env` 파일에 다음 변수를 추가하거나 수정합니다:

```
NEO4J_ENABLE=true
NEO4J_URI=bolt://neo4j:7687
NEO4J_USERNAME=neo4j
NEO4J_PASSWORD=your_strong_password
# 선택 사항: NEO4J_DATABASE=neo4j
```

설명:

- `NEO4J_ENABLE`을 `true`로 설정해야 지식 그래프 관련 로직이 활성화됩니다.
- `NEO4J_URI`의 `neo4j`는 docker-compose 서비스 이름입니다. 외부 인스턴스를 사용하는 경우 실제 주소로 대체하십시오.
- 프로덕션 환경에서 키 관리를 사용하는 경우 비밀번호가 안전한 방식으로 주입되는지 확인하십시오.

## 2단계: Neo4j 서비스 시작

프로젝트에는 Neo4j 구성 요소가 포함되어 있으며 다음 명령으로 직접 시작할 수 있습니다:

```bash
docker-compose --profile neo4j up -d
```

일반적인 검증 명령:

```bash
docker ps | grep neo4j
```

사용자 정의 마운트 또는 메모리가 필요한 경우 `docker-compose.yml`의 `neo4j` 서비스 구성을 편집할 수 있습니다.

## 3단계: WeKnora 서비스 재시작

새로운 환경 변수를 적용하려면 백엔드와 프론트엔드를 재시작합니다(예시):

```bash
make stop && make start
# 또는
docker compose up -d --build
```

백엔드 로그에 `neo4j` 초기화 성공 메시지가 표시되는지 확인하십시오.

## 4단계: 프론트엔드에서 엔티티/관계 추출 활성화

1. WeKnora 프론트엔드 관리 페이지에 로그인합니다.
2. "지식베이스 설정"을 열거나 새 지식베이스를 생성합니다.
3. "엔티티 추출 활성화" 및 "관계 추출 활성화" 스위치를 선택합니다.
4. 인터페이스 프롬프트에 따라 필요한 LLM, 콜백 또는 모델 매개변수를 보충합니다(있는 경우).

저장 후 시스템은 문서 입고 단계에서 엔티티 및 관계 추출 작업을 자동으로 트리거합니다.

## 5단계: 지식 그래프 검증

### 방법 1: Neo4j 콘솔

1. `http://localhost:7474`(또는 해당 호스트/포트)에 접속합니다.
2. `.env`의 계정과 비밀번호로 로그인합니다.
3. `MATCH (n) RETURN n LIMIT 50;`을 실행하여 새 노드/관계가 있는지 확인합니다.

### 방법 2: WeKnora 인터페이스

지식베이스 또는 대화 페이지에서 문서를 업로드한 후 프론트엔드에 그래프 시각화 입구가 표시되어야 합니다. 대화 시 시스템은 의도에 따라 그래프를 자동으로 쿼리하고 보충 정보를 반환합니다.

## 일반적인 문제 해결

- **Neo4j 연결 불가**: 네트워크 접근 가능 여부, `NEO4J_URI` 및 사용자 이름/비밀번호가 올바른지 확인하고 Neo4j 컨테이너 로그를 확인하십시오.
- **노드 생성 안 됨**: 지식베이스에서 엔티티/관계 추출이 켜져 있고 업로드된 문서가 파싱 완료되었는지 확인하십시오. 백엔드 로그에 추출 작업 예외가 있는지 확인하십시오.
- **쿼리 결과 없음**: Neo4j 콘솔에서 `CALL db.schema.visualization;`을 실행하여 스키마가 존재하는지 확인하고 필요시 문서를 다시 가져오십시오.

위 단계를 완료하면 지식 그래프 기능이 성공적으로 활성화되며, RAG 및 Agent 프로세스와 결합하여 질의응답 품질을 향상시킬 수 있습니다.
